#!/usr/bin/env sh
# Husky commit-msg hook for Positronikal repositories
# Enforces conventional commit format and security requirements

# Get the first line of the commit message (subject line)
first_line=$(head -n 1 "$1")

commit_regex='^(feat|fix|docs|style|refactor|test|chore|security|perf)(\(.+\))?: .{1,80}'

if ! echo "$first_line" | grep -qE "$commit_regex"; then
    echo "❌ Invalid commit message format!"
    echo ""
    echo "📝 Commit messages must follow conventional commit format:"
    echo "   type(scope): description"
    echo ""
    echo "📋 Valid types: feat, fix, docs, style, refactor, test, chore, security, perf"
    echo ""
    echo "✅ Examples:"
    echo "   feat: add new terminal command for coding standards"
    echo "   fix(security): patch XSS vulnerability in user input"
    echo "   docs: update contributing guidelines"
    echo "   security: implement additional CSP headers"
    echo ""
    echo "🔒 Security-related commits should use 'security' type"
    echo ""
    echo "❌ Your commit message first line:"
    echo "   $first_line"
    echo ""
    exit 1
fi

# Check for security keywords in commit message
if grep -qE "(security|vulnerability|cve|exploit|attack|breach)" "$1"; then
    echo "🔒 Security-related commit detected."
    echo "   Ensure proper security review has been completed."
fi

echo "✅ Commit message format validated!"
